<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±è¨ˆ - åŒ¿åçŸ­æ­Œäº¤æ›</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .stats-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .stats-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stats-section h2 {
            color: #8b4789;
            border-bottom: 2px solid #8b4789;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f4f8;
            color: #8b4789;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f8f4f8;
        }
        .tanka-content {
            white-space: pre-line;
            font-family: serif;
            line-height: 1.6;
        }
        .category-badge {
            display: inline-block;
            background: #8b4789;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            margin-right: 4px;
        }
        .nav-links {
            text-align: center;
            margin: 20px 0;
        }
        .nav-links a {
            margin: 0 10px;
            color: #8b4789;
            text-decoration: none;
        }
        .nav-links a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="stats-container">
        <h1>ğŸ“Š çµ±è¨ˆæƒ…å ±</h1>
        
        <div class="nav-links">
            <a href="/">ğŸ  ãƒ›ãƒ¼ãƒ </a>
            <a href="/user/stats">ğŸ‘¤ ãƒã‚¤çµ±è¨ˆ</a>
        </div>

        <!-- ã‚«ãƒ†ã‚´ãƒªåˆ¥çµ±è¨ˆï¼ˆSubQueryä½¿ç”¨ï¼‰ -->
        <div class="stats-section">
            <h2>ğŸ“š ã‚«ãƒ†ã‚´ãƒªåˆ¥çµ±è¨ˆ</h2>
            <p><em>SQLè¦ç´ : SubQuery, COUNT</em></p>
            <table>
                <thead>
                    <tr>
                        <th>ã‚«ãƒ†ã‚´ãƒª</th>
                        <th>çŸ­æ­Œæ•°</th>
                        <th>èª¬æ˜</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category in category_stats %}
                    <tr>
                        <td><span class="category-badge">{{ category[0] }}</span></td>
                        <td>{{ category[1] }}ä»¶</td>
                        <td>{{ category[2] }}</td>
                        <td><a href="/category/{{ category[0] }}">ä¸€è¦§ã‚’è¦‹ã‚‹</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- äººæ°—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆSubQueryä½¿ç”¨ï¼‰ -->
        <div class="stats-section">
            <h2>ğŸ† äººæ°—ãƒ©ãƒ³ã‚­ãƒ³ã‚° TOP10</h2>
            <p><em>SQLè¦ç´ : SubQuery, LEFT JOIN, COALESCE, ORDER BY</em></p>
            <table>
                <thead>
                    <tr>
                        <th>é †ä½</th>
                        <th>çŸ­æ­Œ</th>
                        <th>ã‚«ãƒ†ã‚´ãƒª</th>
                        <th>äº¤æ›å›æ•°</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tanka in popular_tankas %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td class="tanka-content">{{ tanka[1] }}</td>
                        <td>
                            {% if tanka[3] %}
                                {% for cat in tanka[3].split(', ') %}
                                    <span class="category-badge">{{ cat }}</span>
                                {% endfor %}
                            {% else %}
                                <span style="color: #999;">æœªåˆ†é¡</span>
                            {% endif %}
                        </td>
                        <td>{{ tanka[2] }}å›</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- å…¨çŸ­æ­Œä¸€è¦§ï¼ˆJOINä½¿ç”¨ï¼‰ -->
        <div class="stats-section">
            <h2>ğŸ“ å…¨çŸ­æ­Œä¸€è¦§</h2>
            <p><em>SQLè¦ç´ : LEFT JOIN, GROUP BY, STRING_AGG</em></p>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>çŸ­æ­Œ</th>
                        <th>ã‚«ãƒ†ã‚´ãƒª</th>
                        <th>äº¤æ›å›æ•°</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tanka in all_tankas %}
                    <tr>
                        <td>{{ tanka[0] }}</td>
                        <td class="tanka-content">{{ tanka[1] }}</td>
                        <td>
                            {% if tanka[2] %}
                                {% for cat in tanka[2].split(', ') %}
                                    <span class="category-badge">{{ cat }}</span>
                                {% endfor %}
                            {% else %}
                                <span style="color: #999;">æœªåˆ†é¡</span>
                            {% endif %}
                        </td>
                        <td>{{ tanka[3] }}å›</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
