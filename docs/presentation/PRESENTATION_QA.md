# プレゼンテーション質疑応答対策ガイド (Q&A)

先生から質問される可能性が高い項目と、それに対する「模範解答」をまとめました。

---

## 1. データベース設計に関する質問

### **Q1. 正規化はどこまで行っていますか？**

- **回答**:
  - **第 3 次正規化 (3NF)** まで実施しています。
  - 具体的には、カテゴリ情報を `tanka_pool` に直接持たせるのではなく、`categories` テーブルとして切り出し、中間テーブル `tanka_categories` を介して多対多の関係を管理しています。これにより、カテゴリ名の一括変更が容易になり、データの重複（更新異常）を排除しています。

### **Q2. 外部キー制約 (Foreign Key) はどのように設定していますか？**

- **回答**:
  - 物理的な `FOREIGN KEY` 制約を明示的に設定し、DB レベルで参照整合性を維持しています。
  - **削除時の挙動 (Referential Actions)** にもこだわっており、例えば `ON DELETE CASCADE` を設定して、短歌が削除されたら中間テーブルの関連レコードも自動で消えるようにしています。一方、ユーザーが消えても短歌は残したいため、`ON DELETE SET NULL` を活用している箇所もあります。

### **Q3. なぜ PostgreSQL を選んだのですか？**

- **回答**:
  - 今回のような「短歌の交換（削除と挿入を同時に行う）」という処理において、**ACID 特性**（原子性・一貫性・独立性・永続性）を厳格に守れるリレーショナルデータベースが必要だったからです。特にトランザクションの信頼性が高い PostgreSQL を採用しました。

---

## 2. システム実装・アーキテクチャに関する質問

### **Q4. 短歌を「交換」する際、データが消えてしまうリスクへの対策は？**

- **回答**:
  - **データベース・トランザクション**を使用しています。
  - 「他者の短歌を削除する」処理と「自分の短歌を挿入する」処理を一つのトランザクションにまとめ、どちらか一方が失敗した場合には `ROLLBACK` されるように実装しています。これにより、データが中途半端に消えたり増えたりするのを防いでいます。

### **Q5. なぜ Flask 内蔵サーバーではなく Waitress を導入したのですか？**

- **回答**:
  - Flask 内蔵サーバーはシングルスレッドかつ、本番環境でのセキュリティや性能が保証されていないためです。
  - **Waitress** はプロダクション品質の WSGI サーバーであり、マルチスレッドでのリクエスト処理に対応しています。大学の要件である「デプロイ可能な 3 層構造」をより実社会の運用に近い形で実現するために導入しました。

### **Q6. Docker を使用している理由は？**

- **回答**:
  - **インフラの再現性**を担保するためです。
  - 開発環境や発表環境（別の PC など）で PostgreSQL のバージョンや設定が異なると動作に支障が出ますが、Docker コンテナに閉じ込めることで、誰の環境でも `docker-compose up` だけで全く同じ DB 環境が立ち上がることを保証しています。

---

## 3. その他の技術的詳細

### **Q7. ユーザーの匿名性はどのように担保していますか？**

- **回答**:
  - サーバー側にはユーザー名や住所などの個人情報は一切保存せず、ブラウザごとの `session_id` だけを管理しています。
  - また、自分が「どの短歌を受け取ったか」という履歴は、プライバシー保護の観点からサーバーの DB ではなく、ブラウザの **LocalStorage** にのみ保存するハイブリッドな設計にしています。

---

## 💡 アドバイス

- **SQL について聞かれたら**: `app/models.py` を見せながら、「Jinja2 のテンプレートだけでなく、生 SQL を使って JOIN やサブクエリ、ORDER BY RANDOM()による動的抽出を行っている」と伝えると技術点の評価が高まります。
- **デモ中にエラーが起きたら**: 「自動セットアップ機能とマイグレーション機能を実装しているので、コンテナを再起動するだけでスキーマが自動修復されます」と答えると、堅牢性をアピールできます。
